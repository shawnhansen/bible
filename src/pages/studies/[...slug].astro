---
import Base from '../../layouts/Base.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const entries = await getCollection('studies');
  return entries.map((entry) => ({ params: { slug: entry.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntry('studies', slug);

if (!entry) {
  throw new Response('Not found', { status: 404 });
}

const { Content } = await entry.render();
const data = entry.data;
---
<Base title={data.title} description={data.summary}>
  <Header />
  <main class="container pad" style="max-width:70ch">
    <p class="mono small" style="color:var(--accent);margin:0">{data.passage}</p>
    <h1 style="margin:.25rem 0 1rem">{data.title}</h1>
    {data.summary && <p class="lead">{data.summary}</p>}
    {data.diagram && (
      <figure class="card" style="margin:1rem 0">
        <pre class="mono small" aria-label="Diagram source">{data.diagram}</pre>
      </figure>
    )}
    <article class="stack" style="--space:1rem">
      <Content />
    </article>
  </main>
  <Footer />
</Base>
